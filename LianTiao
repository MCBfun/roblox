local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

-- é…ç½®
local config = {
    enabled = false,
    jumpHeight = 50,
    detectionDistance = 4,
    cooldown = 0.05,
    raycastDistance = 10
}

-- çŠ¶æ€å˜é‡
local lastJumpTime = 0
local isJumping = false
local character, humanoid, rootPart
local screenGui

-- åˆ›å»ºUI
local function createUI()
    -- åˆ é™¤æ—§çš„UI
    if screenGui then
        screenGui:Destroy()
    end
    
    -- åˆ›å»ºScreenGui
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "AirJumpUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player:WaitForChild("PlayerGui")

    -- ä¸»åœ†å½¢æŒ‰é’®
    local circleButton = Instance.new("TextButton")
    circleButton.Size = UDim2.new(0, 80, 0, 80)
    circleButton.Position = UDim2.new(1, -100, 1, -100)
    circleButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
    circleButton.Text = "æŒ‰ä½\nè·³è·ƒ"
    circleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    circleButton.TextSize = 12
    circleButton.Font = Enum.Font.GothamBold
    circleButton.TextWrapped = true
    circleButton.Parent = screenGui

    local circleCorner = Instance.new("UICorner")
    circleCorner.CornerRadius = UDim.new(1, 0)
    circleCorner.Parent = circleButton

    local uiStroke = Instance.new("UIStroke")
    uiStroke.Color = Color3.fromRGB(255, 255, 255)
    uiStroke.Thickness = 2
    uiStroke.Parent = circleButton

    -- å…³é—­æŒ‰é’®
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -40, 0, 10)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.TextSize = 16
    closeButton.Font = Enum.Font.GothamBold
    closeButton.Parent = screenGui

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0.5, 0)
    closeCorner.Parent = closeButton

    local closeStroke = Instance.new("UIStroke")
    closeStroke.Color = Color3.fromRGB(255, 255, 255)
    closeStroke.Thickness = 1.5
    closeStroke.Parent = closeButton

    -- æŒ‰é’®äº‹ä»¶
    circleButton.MouseButton1Down:Connect(function()
        config.enabled = true
        circleButton.Text = "æ¾å¼€\nåœæ­¢"
        circleButton.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
        print("ç©ºæ°”è·³è·ƒå·²å¯åŠ¨")
    end)

    circleButton.MouseButton1Up:Connect(function()
        config.enabled = false
        circleButton.Text = "æŒ‰ä½\nè·³è·ƒ"
        circleButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
        print("ç©ºæ°”è·³è·ƒå·²åœæ­¢")
    end)

    closeButton.MouseButton1Click:Connect(function()
        config.enabled = false
        screenGui:Destroy()
        print("UIå·²å…³é—­")
    end)

    print("âœ… UIåˆ›å»ºå®Œæˆ")
    return screenGui
end

-- è·å–è§’è‰²éƒ¨ä»¶
local function getCharacterParts()
    if player.Character then
        character = player.Character
        humanoid = character:FindFirstChildOfClass("Humanoid")
        rootPart = character:FindFirstChild("HumanoidRootPart")
        return humanoid ~= nil and rootPart ~= nil
    end
    return false
end

-- æ£€æµ‹åœ°é¢è·ç¦»
local function getGroundDistance()
    if not rootPart then return math.huge end
    
    local rayOrigin = rootPart.Position
    local rayDirection = Vector3.new(0, -config.raycastDistance, 0)
    
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    if character then
        raycastParams.FilterDescendantsInstances = {character}
    end
    
    local raycastResult = workspace:Raycast(rayOrigin, rayDirection, raycastParams)
    
    if raycastResult then
        local distance = (raycastResult.Position - rayOrigin).Magnitude
        return distance
    end
    
    return math.huge
end

-- æ‰§è¡Œè·³è·ƒ
local function performJump()
    if not config.enabled then return end
    if tick() - lastJumpTime < config.cooldown then return end
    
    -- ç¡®ä¿è§’è‰²éƒ¨ä»¶å­˜åœ¨
    if not getCharacterParts() then return end
    if not humanoid or humanoid.Health <= 0 then return end
    
    local groundDistance = getGroundDistance()
    
    -- æ£€æŸ¥æ˜¯å¦åœ¨è·³è·ƒèŒƒå›´å†…
    if groundDistance <= config.detectionDistance and groundDistance > 0.5 then
        -- è·³è·ƒ
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        
        -- è®¡ç®—è·³è·ƒé€Ÿåº¦
        local jumpVelocity = math.sqrt(2 * workspace.Gravity * config.jumpHeight / 196.2)
        local currentVelocity = rootPart.Velocity
        rootPart.Velocity = Vector3.new(currentVelocity.X, jumpVelocity, currentVelocity.Z)
        
        lastJumpTime = tick()
        
        print(string.format("è·³è·ƒ! è·ç¦»: %.2fç±³", groundDistance))
    end
end

-- é”®ç›˜æ§åˆ¶
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Space then
        config.enabled = true
        print("ç©ºæ ¼é”®æŒ‰ä¸‹ - å¯åŠ¨è·³è·ƒ")
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Space then
        config.enabled = false
        print("ç©ºæ ¼é”®æ¾å¼€ - åœæ­¢è·³è·ƒ")
    end
end)

-- ä¸»å¾ªç¯
RunService.Heartbeat:Connect(function(deltaTime)
    if config.enabled then
        performJump()
    end
end)

-- è§’è‰²é‡ç”Ÿå¤„ç†
player.CharacterAdded:Connect(function(newCharacter)
    print("è§’è‰²é‡ç”Ÿ...")
    
    -- ç­‰å¾…è§’è‰²åŠ è½½å®Œæˆ
    wait(1)
    
    -- é‡æ–°è·å–è§’è‰²éƒ¨ä»¶
    getCharacterParts()
    
    -- ç¡®ä¿UIå­˜åœ¨
    if not screenGui or not screenGui.Parent then
        createUI()
    end
    
    -- é‡ç½®çŠ¶æ€
    config.enabled = false
    lastJumpTime = 0
    
    print("è§’è‰²é‡ç”Ÿå®Œæˆ")
end)

-- åˆå§‹åŒ–
wait(2)

-- è·å–åˆå§‹è§’è‰²
getCharacterParts()

-- åˆ›å»ºUI
createUI()

print("ğŸ¯ ç©ºæ°”è·³è·ƒç³»ç»Ÿå·²åŠ è½½!")
print("ä½¿ç”¨æ–¹æ³•:")
print("- æŒ‰ä½åœ†å½¢æŒ‰é’®æˆ–ç©ºæ ¼é”®å¯åŠ¨è·³è·ƒ")
print("- æ¾å¼€åœæ­¢")
print("- ç‚¹å‡»Xå…³é—­UI")
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "å…¬å‘Š",
    Text = "æ‰‹æ„Ÿè„šæœ¬",
    Icon = "rbxassetid://12832356728", -- é€‰ï¼šå›¾æ ‡IDï¼ˆè¿™é‡Œç”¨ä¸ªç¤ºä¾‹ç¬‘è„¸å›¾æ ‡ï¼‰
    Duration = 3, -- æ˜¾ç¤ºæ—¶é•¿ï¼ˆç§’ï¼‰
    Position = UDim2.new(0, 20, 1, -50) -- å®šä½åˆ°å·¦ä¸‹è§’
})
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "robloxå",
    Text = "MCBFUNAE",
    Icon = "rbxassetid://18143239786", -- é€‰ï¼šå›¾æ ‡IDï¼ˆè¿™é‡Œç”¨ä¸ªç¤ºä¾‹ç¬‘è„¸å›¾æ ‡ï¼‰
    Duration = 8, -- æ˜¾ç¤ºæ—¶é•¿ï¼ˆç§’ï¼‰
    Position = UDim2.new(0, 20, 1, -50) -- å®šä½åˆ°å·¦ä¸‹è§’
})
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "bilibiliå",
    Text = "æ¸”ç‚’é±¼",
    Icon = "rbxassetid://139532409537387", -- é€‰ï¼šå›¾æ ‡IDï¼ˆè¿™é‡Œç”¨ä¸ªç¤ºä¾‹ç¬‘è„¸å›¾æ ‡ï¼‰
    Duration = 8, -- æ˜¾ç¤ºæ—¶é•¿ï¼ˆç§’ï¼‰
    Position = UDim2.new(0, 20, 1, -50) -- å®šä½åˆ°å·¦ä¸‹è§’
})
