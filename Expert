-- Expert - ç­‰å€™å…ä¼ é€è„šæœ¬
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local isRunning = true

-- åˆ›å»ºæœ€å°åŒ–UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ExpertGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 120, 0, 120)  -- è°ƒæ•´é«˜åº¦ä¸º120ï¼Œåªå®¹çº³ä¸€ä¸ªæŒ‰é’®
mainFrame.Position = UDim2.new(0.02, 0, 0.3, 0)  -- æ”¹ä¸ºå›ºå®šä½ç½®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨AnchorPoint
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 1
mainFrame.BorderColor3 = Color3.fromRGB(80, 80, 100)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

-- åœ†è§’æ•ˆæœ
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 6)
uiCorner.Parent = mainFrame

-- æ ‡é¢˜æ 
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 25)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

-- æ ‡é¢˜æ åœ†è§’
local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 6)
titleCorner.Parent = titleBar

local title = Instance.new("TextLabel")
title.Text = "Expert"
title.Size = UDim2.new(1, -80, 1, 0)
title.Position = UDim2.new(0, 5, 0, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Font = Enum.Font.SourceSansSemibold
title.TextSize = 14
title.Parent = titleBar

-- æ§åˆ¶æŒ‰é’®å®¹å™¨ï¼ˆç°åœ¨æœ‰3ä¸ªæŒ‰é’®ï¼‰
local controlButtons = Instance.new("Frame")
controlButtons.Name = "ControlButtons"
controlButtons.Size = UDim2.new(0, 75, 1, 0)
controlButtons.Position = UDim2.new(1, -75, 0, 0)
controlButtons.BackgroundTransparency = 1
controlButtons.Parent = titleBar

-- ç¼©æ”¾æŒ‰é’®ï¼ˆæ–°å¢ï¼‰
local zoomBtn = Instance.new("TextButton")
zoomBtn.Name = "ZoomButton"
zoomBtn.Size = UDim2.new(0, 25, 0, 25)
zoomBtn.Position = UDim2.new(0, 0, 0, 0)
zoomBtn.Text = "âºï¸"
zoomBtn.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
zoomBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
zoomBtn.Font = Enum.Font.SourceSansBold
zoomBtn.TextSize = 14
zoomBtn.AutoButtonColor = false
zoomBtn.Parent = controlButtons

-- ç¼©å°æŒ‰é’®
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Name = "MinimizeButton"
minimizeBtn.Size = UDim2.new(0, 25, 0, 25)
minimizeBtn.Position = UDim2.new(0, 25, 0, 0)
minimizeBtn.Text = "_"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 16
minimizeBtn.AutoButtonColor = false
minimizeBtn.Parent = controlButtons

-- å…³é—­æŒ‰é’®
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(0, 50, 0, 0)
closeBtn.Text = "Ã—"
closeBtn.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 16
closeBtn.AutoButtonColor = false
closeBtn.Parent = controlButtons

-- ç­‰å€™å…ä¼ é€æŒ‰é’®
local backroomTeleportButton = Instance.new("TextButton")
backroomTeleportButton.Name = "BackroomTeleportButton"
backroomTeleportButton.Size = UDim2.new(1, -10, 0, 40)
backroomTeleportButton.Position = UDim2.new(0, 5, 0, 30)
backroomTeleportButton.Text = "ä¼ é€ç­‰å€™å…"
backroomTeleportButton.BackgroundColor3 = Color3.fromRGB(60, 180, 100)  -- ç»¿è‰²
backroomTeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
backroomTeleportButton.Font = Enum.Font.SourceSansSemibold
backroomTeleportButton.TextSize = 14
backroomTeleportButton.TextWrapped = true
backroomTeleportButton.AutoButtonColor = false
backroomTeleportButton.Parent = mainFrame

-- æ·»åŠ åœ†è§’
local teleportCorner = Instance.new("UICorner")
teleportCorner.CornerRadius = UDim.new(0, 5)
teleportCorner.Parent = backroomTeleportButton

-- çŠ¶æ€æ˜¾ç¤ºï¼ˆç¼©å°åï¼‰
local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Size = UDim2.new(1, -10, 1, -10)
statusLabel.Position = UDim2.new(0, 5, 0, 5)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
statusLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
statusLabel.TextSize = 12
statusLabel.TextWrapped = true
statusLabel.Visible = false
statusLabel.Parent = mainFrame

-- å˜é‡
local isMinimized = false
local isZoomed = false  -- æ–°å¢ï¼šç¼©æ”¾çŠ¶æ€
local originalSize = mainFrame.Size
local originalPosition = mainFrame.Position  -- ä¿å­˜åŸå§‹ä½ç½®
local minimizedSize = UDim2.new(0, 80, 0, 40)  -- æ›´å°çš„ç¼©å°æ¨¡å¼
local zoomedSize = UDim2.new(0, 140, 0, 130)  -- æ”¾å¤§åçš„å°ºå¯¸ï¼ˆé«˜åº¦è°ƒæ•´ä¸º130ï¼‰

-- ç­‰å€™å…åæ ‡
local backroomLocation = {
    X = 163.15,
    Y = 9,
    Z = 955.4
}

-- æŒ‰é’®æ‚¬åœæ•ˆæœå‡½æ•°
local function setupButtonHover(button)
    local originalColor = button.BackgroundColor3

    button.MouseEnter:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(
                math.min(255, originalColor.R * 255 + 30),
                math.min(255, originalColor.G * 255 + 30),
                math.min(255, originalColor.B * 255 + 30)
            )
        })
        tween:Play()
    end)

    button.MouseLeave:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = originalColor
        })
        tween:Play()
    end)
end

-- åº”ç”¨æ‚¬åœæ•ˆæœ
setupButtonHover(backroomTeleportButton)
setupButtonHover(zoomBtn)
setupButtonHover(minimizeBtn)
setupButtonHover(closeBtn)

-- æ‰§è¡Œç­‰å€™å…ä¼ é€
local function performBackroomTeleport()
    local character = player.Character
    if not character then 
        print("[Expert] é”™è¯¯: è§’è‰²ä¸å­˜åœ¨")
        return false
    end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then 
        print("[Expert] é”™è¯¯: æ‰¾ä¸åˆ°HumanoidRootPart")
        return false
    end
    
    -- ä¼ é€åˆ°ç­‰å€™å…
    local teleportPos = Vector3.new(
        backroomLocation.X,
        backroomLocation.Y,
        backroomLocation.Z
    )
    
    humanoidRootPart.CFrame = CFrame.new(teleportPos)
    
    -- æ›´æ–°æŒ‰é’®æ–‡æœ¬
    if not isMinimized then
        backroomTeleportButton.Text = "âœ… å·²ä¼ é€ç­‰å€™å…"
        -- 3ç§’åæ¢å¤åŸæ–‡æœ¬
        task.wait(3)
        backroomTeleportButton.Text = "ä¼ é€ç­‰å€™å…"
    end
    
    -- å¦‚æœå¤„äºç¼©å°æ¨¡å¼ï¼Œæ›´æ–°çŠ¶æ€
    if isMinimized then
        statusLabel.Text = "âœ… å·²ä¼ é€ç­‰å€™å…"
        task.wait(3)
        statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
    end
    
    print(string.format("[Expert] å·²ä¼ é€åˆ°ç­‰å€™å… (X:%.2f, Y:%.2f, Z:%.2f)", 
        backroomLocation.X, backroomLocation.Y, backroomLocation.Z))
    
    return true
end

-- ç¼©æ”¾åŠŸèƒ½ï¼ˆä¿®å¤ç‰ˆï¼‰
zoomBtn.MouseButton1Click:Connect(function()
    isZoomed = not isZoomed

    if isZoomed then
        -- æ”¾å¤§ç•Œé¢ï¼Œä¿æŒå½“å‰ä½ç½®ä¸å˜
        local currentPos = mainFrame.Position
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = zoomedSize,
            Position = currentPos
        })
        tween:Play()

        zoomBtn.Text = "âºï¸"
        zoomBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)

        -- æ”¾å¤§åæ›´æ–°æ–‡æœ¬å¤§å°
        if not isMinimized then
            backroomTeleportButton.TextSize = 15
            title.TextSize = 15
        end
    else
        -- ç¼©å°åˆ°åŸå§‹å¤§å°ï¼Œä¿æŒå½“å‰ä½ç½®ä¸å˜
        local currentPos = mainFrame.Position
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = originalSize,
            Position = currentPos
        })
        tween:Play()

        zoomBtn.Text = "â¬…ï¸"
        zoomBtn.BackgroundColor3 = Color3.fromRGB(60, 100, 180)

        -- æ¢å¤åŸå§‹æ–‡æœ¬å¤§å°
        if not isMinimized then
            backroomTeleportButton.TextSize = 14
            title.TextSize = 14
        end
    end
end)

-- ç¼©å°åŠŸèƒ½ï¼ˆä¿®å¤ç‰ˆï¼‰
minimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized

    if isMinimized then
        -- ç¼©å°åŠ¨ç”»ï¼Œä¿æŒå½“å‰ä½ç½®
        local currentPos = mainFrame.Position
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = minimizedSize,
            Position = currentPos
        })
        tween:Play()

        tween.Completed:Wait()  -- ç­‰å¾…åŠ¨ç”»å®Œæˆ

        backroomTeleportButton.Visible = false
        statusLabel.Visible = true
        minimizeBtn.Text = "+"
        title.Text = "ğŸ¯"
        statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
        
    else
        -- æ¢å¤æ˜¾ç¤º
        backroomTeleportButton.Visible = true
        statusLabel.Visible = false
        minimizeBtn.Text = "_"
        title.Text = "Expert"

        -- æ¢å¤å¤§å°ï¼ˆæ ¹æ®å½“å‰ç¼©æ”¾çŠ¶æ€ï¼‰ï¼Œä¿æŒå½“å‰ä½ç½®
        local currentPos = mainFrame.Position
        local targetSize = isZoomed and zoomedSize or originalSize
        
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = targetSize,
            Position = currentPos
        })
        tween:Play()
    end
end)

-- å…³é—­åŠŸèƒ½
closeBtn.MouseButton1Click:Connect(function()
    -- æ·¡å‡ºåŠ¨ç”»
    local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
        BackgroundTransparency = 0.8,
        Position = mainFrame.Position + UDim2.new(0, 0, 0, -20)
    })
    tween:Play()

    tween.Completed:Wait()  -- ç­‰å¾…åŠ¨ç”»å®Œæˆ
    screenGui:Destroy()
    isRunning = false
end)

-- ç­‰å€™å…ä¼ é€æŒ‰é’®åŠŸèƒ½
backroomTeleportButton.MouseButton1Click:Connect(function()
    performBackroomTeleport()
end)

-- å¿«æ·é”®ï¼ˆä¿®å¤ç‰ˆï¼‰
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end

    -- Bé”®ï¼šè§¦å‘ç­‰å€™å…ä¼ é€
    if input.KeyCode == Enum.KeyCode.B then
        performBackroomTeleport()
    end

    -- Mé”®ï¼šç¼©å°/æ”¾å¤§ï¼ˆä¿®å¤ç‰ˆï¼‰
    if input.KeyCode == Enum.KeyCode.M then
        isMinimized = not isMinimized

        if isMinimized then
            local currentPos = mainFrame.Position
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = minimizedSize,
                Position = currentPos
            })
            tween:Play()

            tween.Completed:Wait()

            backroomTeleportButton.Visible = false
            statusLabel.Visible = true
            minimizeBtn.Text = "+"
            title.Text = "ğŸ¯"
            statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
            
        else
            backroomTeleportButton.Visible = true
            statusLabel.Visible = false
            minimizeBtn.Text = "_"
            title.Text = "Expert"

            -- æ¢å¤å¤§å°ï¼ˆæ ¹æ®å½“å‰ç¼©æ”¾çŠ¶æ€ï¼‰ï¼Œä¿æŒå½“å‰ä½ç½®
            local currentPos = mainFrame.Position
            local targetSize = isZoomed and zoomedSize or originalSize
            
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = targetSize,
                Position = currentPos
            })
            tween:Play()
        end
    end

    -- Zé”®ï¼šè§¦å‘ç¼©æ”¾ï¼ˆä¿®å¤ç‰ˆï¼‰
    if input.KeyCode == Enum.KeyCode.Z then
        isZoomed = not isZoomed

        if isZoomed then
            -- æ”¾å¤§ç•Œé¢ï¼Œä¿æŒå½“å‰ä½ç½®
            local currentPos = mainFrame.Position
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = zoomedSize,
                Position = currentPos
            })
            tween:Play()

            zoomBtn.Text = "â–¶ï¸"
            zoomBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)

            -- æ”¾å¤§åæ›´æ–°æ–‡æœ¬å¤§å°
            if not isMinimized then
                backroomTeleportButton.TextSize = 15
                title.TextSize = 15
            end
        else
            -- ç¼©å°åˆ°åŸå§‹å¤§å°ï¼Œä¿æŒå½“å‰ä½ç½®
            local currentPos = mainFrame.Position
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = originalSize,
                Position = currentPos
            })
            tween:Play()

            zoomBtn.Text = "â¸ï¸"
            zoomBtn.BackgroundColor3 = Color3.fromRGB(60, 100, 180)

            -- æ¢å¤åŸå§‹æ–‡æœ¬å¤§å°
            if not isMinimized then
                backroomTeleportButton.TextSize = 14
                title.TextSize = 14
            end
        end
    end
end)

-- åˆå§‹æ·¡å…¥åŠ¨ç”»ï¼ˆä¿®å¤ç‰ˆï¼‰
local originalPosition = UDim2.new(0.02, 0, 0.3, 0)  -- æ˜ç¡®å®šä¹‰åŸå§‹ä½ç½®
mainFrame.BackgroundTransparency = 1
mainFrame.Position = originalPosition + UDim2.new(0, 0, 0, -30)

task.wait(0.1)

local fadeInTween = TweenService:Create(mainFrame, TweenInfo.new(0.5), {
    BackgroundTransparency = 0.2,
    Position = originalPosition
})
fadeInTween:Play()

print("=== Expertè„šæœ¬å·²åŠ è½½ ===")
print(string.format("ç­‰å€™å…åæ ‡: X:%.2f, Y:%.2f, Z:%.2f", 
    backroomLocation.X, backroomLocation.Y, backroomLocation.Z))
print("å¿«æ·é”®æŒ‡å—:")
print("  Bé”® - ä¼ é€åˆ°ç­‰å€™å…")
print("  Mé”® - ç¼©å°/æ”¾å¤§ç•Œé¢")
print("  Zé”® - ç¼©æ”¾ç•Œé¢")
print("çŠ¶æ€: å°±ç»ª")

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Expert",
    Text = "ç­‰å€™å…ä¼ é€è„šæœ¬å·²åŠ è½½",
    Icon = "rbxassetid://14550088217",
    Duration = 5,
    Position = UDim2.new(0, 20, 1, -50)
})