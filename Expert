-- Expert
local SoundService = game:GetService("SoundService")

-- åˆ›å»ºéŸ³é¢‘å®ä¾‹
local sound = Instance.new("Sound")
sound.SoundId = "rbxassetid://7390036132"  -- æ›¿æ¢ä¸ºä½ çš„éŸ³é¢‘ID
sound.Parent = SoundService

-- æ’­æ”¾éŸ³é¢‘
sound:Play()
-- Expert - ç­‰å€™å…ä¼ é€è„šæœ¬
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local isRunning = true

-- åˆ›å»ºæœ€å°åŒ–UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ExpertGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 120, 0, 295)
mainFrame.Position = UDim2.new(0.02, 0, 0.3, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 1
mainFrame.BorderColor3 = Color3.fromRGB(80, 80, 100)
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

-- åœ†è§’æ•ˆæœ
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 6)
uiCorner.Parent = mainFrame

-- æ ‡é¢˜æ 
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 25)
titleBar.BackgroundColor3 = Color3.fromRGB(30, 30, 45)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

-- æ ‡é¢˜æ åœ†è§’
local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 6)
titleCorner.Parent = titleBar

local title = Instance.new("TextLabel")
title.Text = "Expert"
title.Size = UDim2.new(1, -80, 1, 0)
title.Position = UDim2.new(0, 5, 0, 0)
title.BackgroundTransparency = 1
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextXAlignment = Enum.TextXAlignment.Left
title.Font = Enum.Font.SourceSansSemibold
title.TextSize = 14
title.Parent = titleBar

-- æ§åˆ¶æŒ‰é’®å®¹å™¨
local controlButtons = Instance.new("Frame")
controlButtons.Name = "ControlButtons"
controlButtons.Size = UDim2.new(0, 75, 1, 0)
controlButtons.Position = UDim2.new(1, -75, 0, 0)
controlButtons.BackgroundTransparency = 1
controlButtons.Parent = titleBar

-- ç¼©æ”¾æŒ‰é’®
local zoomBtn = Instance.new("TextButton")
zoomBtn.Name = "ZoomButton"
zoomBtn.Size = UDim2.new(0, 25, 0, 25)
zoomBtn.Position = UDim2.new(0, 0, 0, 0)
zoomBtn.Text = "âºï¸"
zoomBtn.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
zoomBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
zoomBtn.Font = Enum.Font.SourceSansBold
zoomBtn.TextSize = 14
zoomBtn.AutoButtonColor = false
zoomBtn.Parent = controlButtons

-- ç¼©å°æŒ‰é’®
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Name = "MinimizeButton"
minimizeBtn.Size = UDim2.new(0, 25, 0, 25)
minimizeBtn.Position = UDim2.new(0, 25, 0, 0)
minimizeBtn.Text = "_"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
minimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 16
minimizeBtn.AutoButtonColor = false
minimizeBtn.Parent = controlButtons

-- å…³é—­æŒ‰é’®
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(0, 50, 0, 0)
closeBtn.Text = "Ã—"
closeBtn.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 16
closeBtn.AutoButtonColor = false
closeBtn.Parent = controlButtons

-- ç­‰å€™å…ä¼ é€æŒ‰é’®
local backroomTeleportButton = Instance.new("TextButton")
backroomTeleportButton.Name = "BackroomTeleportButton"
backroomTeleportButton.Size = UDim2.new(1, -10, 0, 40)
backroomTeleportButton.Position = UDim2.new(0, 5, 0, 30)
backroomTeleportButton.Text = "ä¼ é€ç­‰å€™å…"
backroomTeleportButton.BackgroundColor3 = Color3.fromRGB(60, 180, 100)
backroomTeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
backroomTeleportButton.Font = Enum.Font.SourceSansSemibold
backroomTeleportButton.TextSize = 14
backroomTeleportButton.TextWrapped = true
backroomTeleportButton.AutoButtonColor = false
backroomTeleportButton.Parent = mainFrame

local teleportCorner = Instance.new("UICorner")
teleportCorner.CornerRadius = UDim.new(0, 5)
teleportCorner.Parent = backroomTeleportButton

-- å‰§é™¢ç«è½¦ä¼ é€æŒ‰é’®
local theaterTrainButton = Instance.new("TextButton")
theaterTrainButton.Name = "TheaterTrainButton"
theaterTrainButton.Size = UDim2.new(1, -10, 0, 40)
theaterTrainButton.Position = UDim2.new(0, 5, 0, 75)
theaterTrainButton.Text = "ä¼ é€å‰§é™¢ç«è½¦"
theaterTrainButton.BackgroundColor3 = Color3.fromRGB(180, 100, 60)
theaterTrainButton.TextColor3 = Color3.fromRGB(255, 255, 255)
theaterTrainButton.Font = Enum.Font.SourceSansSemibold
theaterTrainButton.TextSize = 14
theaterTrainButton.TextWrapped = true
theaterTrainButton.AutoButtonColor = false
theaterTrainButton.Parent = mainFrame

local theaterTrainCorner = Instance.new("UICorner")
theaterTrainCorner.CornerRadius = UDim.new(0, 5)
theaterTrainCorner.Parent = theaterTrainButton

-- å·¥å‚ç«è½¦ä¼ é€æŒ‰é’®
local factoryTrainButton = Instance.new("TextButton")
factoryTrainButton.Name = "FactoryTrainButton"
factoryTrainButton.Size = UDim2.new(1, -10, 0, 40)
factoryTrainButton.Position = UDim2.new(0, 5, 0, 120)
factoryTrainButton.Text = "ä¼ é€å·¥å‚ç«è½¦"
factoryTrainButton.BackgroundColor3 = Color3.fromRGB(100, 100, 200)
factoryTrainButton.TextColor3 = Color3.fromRGB(255, 255, 255)
factoryTrainButton.Font = Enum.Font.SourceSansSemibold
factoryTrainButton.TextSize = 14
factoryTrainButton.TextWrapped = true
factoryTrainButton.AutoButtonColor = false
factoryTrainButton.Parent = mainFrame

local factoryTrainCorner = Instance.new("UICorner")
factoryTrainCorner.CornerRadius = UDim.new(0, 5)
factoryTrainCorner.Parent = factoryTrainButton

-- ä¸‹æ°´é“ä¼ é€æŒ‰é’®
local sewerTeleportButton = Instance.new("TextButton")
sewerTeleportButton.Name = "SewerTeleportButton"
sewerTeleportButton.Size = UDim2.new(1, -10, 0, 40)
sewerTeleportButton.Position = UDim2.new(0, 5, 0, 165)
sewerTeleportButton.Text = "ä¼ é€ä¸‹æ°´é“"
sewerTeleportButton.BackgroundColor3 = Color3.fromRGB(100, 180, 100)
sewerTeleportButton.TextColor3 = Color3.fromRGB(255, 255, 255)
sewerTeleportButton.Font = Enum.Font.SourceSansSemibold
sewerTeleportButton.TextSize = 14
sewerTeleportButton.TextWrapped = true
sewerTeleportButton.AutoButtonColor = false
sewerTeleportButton.Parent = mainFrame

local sewerCorner = Instance.new("UICorner")
sewerCorner.CornerRadius = UDim.new(0, 5)
sewerCorner.Parent = sewerTeleportButton

-- è‡ªæ•‘åŠŸèƒ½æŒ‰é’®
local selfRescueButton = Instance.new("TextButton")
selfRescueButton.Name = "SelfRescueButton"
selfRescueButton.Size = UDim2.new(1, -10, 0, 40)
selfRescueButton.Position = UDim2.new(0, 5, 0, 210)
selfRescueButton.Text = "è‡ªæ•‘\nå›ºå®šä½ç½® [OFF]"
selfRescueButton.BackgroundColor3 = Color3.fromRGB(180, 60, 180)
selfRescueButton.TextColor3 = Color3.fromRGB(255, 255, 255)
selfRescueButton.Font = Enum.Font.SourceSansSemibold
selfRescueButton.TextSize = 14
selfRescueButton.TextWrapped = true
selfRescueButton.AutoButtonColor = false
selfRescueButton.Parent = mainFrame

local selfRescueCorner = Instance.new("UICorner")
selfRescueCorner.CornerRadius = UDim.new(0, 5)
selfRescueCorner.Parent = selfRescueButton

-- ä»™äººæ¨¡å¼æŒ‰é’®
local ninjaModeButton = Instance.new("TextButton")
ninjaModeButton.Name = "NinjaModeButton"
ninjaModeButton.Size = UDim2.new(1, -10, 0, 40)
ninjaModeButton.Position = UDim2.new(0, 5, 0, 255)
ninjaModeButton.Text = "ä»™äººæ¨¡å¼\n[OFF]"
ninjaModeButton.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
ninjaModeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ninjaModeButton.Font = Enum.Font.SourceSansSemibold
ninjaModeButton.TextSize = 14
ninjaModeButton.TextWrapped = true
ninjaModeButton.AutoButtonColor = false
ninjaModeButton.Parent = mainFrame

local ninjaModeCorner = Instance.new("UICorner")
ninjaModeCorner.CornerRadius = UDim.new(0, 5)
ninjaModeCorner.Parent = ninjaModeButton

-- çŠ¶æ€æ˜¾ç¤ºï¼ˆç¼©å°åï¼‰
local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Size = UDim2.new(1, -10, 1, -10)
statusLabel.Position = UDim2.new(0, 5, 0, 5)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
statusLabel.TextColor3 = Color3.fromRGB(200, 200, 220)
statusLabel.TextSize = 12
statusLabel.TextWrapped = true
statusLabel.Visible = false
statusLabel.Parent = mainFrame

-- å˜é‡
local isMinimized = false
local isZoomed = false
local originalSize = mainFrame.Size
local originalPosition = mainFrame.Position
local minimizedSize = UDim2.new(0, 80, 0, 40)
local zoomedSize = UDim2.new(0, 140, 0, 305)

-- è‡ªæ•‘åŠŸèƒ½ç›¸å…³å˜é‡
local isSelfRescueActive = false
local selfRescueConnection = nil
local savedPosition = nil
local savedCFrame = nil

-- ä»™äººæ¨¡å¼ç›¸å…³å˜é‡
local isNinjaModeActive = false
local originalWalkSpeed = 16
local originalJumpPower = 50
local ninjaModeMultiplier = 2.5
local infiniteJumpEnabled = false
local ninjaModeConnection = nil

-- åæ ‡å®šä¹‰
local backroomLocation = {X = 163.15, Y = 9, Z = 955.4}
local theaterTrainLocation = {X = -5.4, Y = 73, Z = -145.3}
local factoryTrainLocation = {X = 300, Y = 17, Z = 475}
local sewerLocation = {X = 356, Y = 528, Z = -179}

-- æŒ‰é’®æ‚¬åœæ•ˆæœå‡½æ•°
local function setupButtonHover(button)
    local originalColor = button.BackgroundColor3
    button.MouseEnter:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(
                math.min(255, originalColor.R * 255 + 30),
                math.min(255, originalColor.G * 255 + 30),
                math.min(255, originalColor.B * 255 + 30)
            )
        })
        tween:Play()
    end)
    button.MouseLeave:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = originalColor
        })
        tween:Play()
    end)
end

setupButtonHover(backroomTeleportButton)
setupButtonHover(theaterTrainButton)
setupButtonHover(factoryTrainButton)
setupButtonHover(sewerTeleportButton)
setupButtonHover(selfRescueButton)
setupButtonHover(ninjaModeButton)
setupButtonHover(zoomBtn)
setupButtonHover(minimizeBtn)
setupButtonHover(closeBtn)

-- è‡ªæ•‘åŠŸèƒ½
local function startSelfRescue()
    if isSelfRescueActive then return end
    
    local character = player.Character
    if not character then return false end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end

    savedPosition = humanoidRootPart.Position
    savedCFrame = humanoidRootPart.CFrame
    isSelfRescueActive = true
    selfRescueButton.Text = "è‡ªæ•‘\nå›ºå®šä½ç½® [ON]"
    selfRescueButton.BackgroundColor3 = Color3.fromRGB(150, 30, 150)

    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.Name = "ExpertSelfRescuePosition"
    bodyPosition.P = 100000
    bodyPosition.D = 1000
    bodyPosition.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyPosition.Position = savedPosition
    bodyPosition.Parent = humanoidRootPart

    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.WalkSpeed = 0
        humanoid.JumpPower = 0
    end

    selfRescueConnection = RunService.Heartbeat:Connect(function()
        if not isSelfRescueActive or not character or character.Parent == nil then
            stopSelfRescue()
            return
        end
        local currentRootPart = character:FindFirstChild("HumanoidRootPart")
        if not currentRootPart then return end
        currentRootPart.CFrame = savedCFrame
        local existingBodyPosition = currentRootPart:FindFirstChild("ExpertSelfRescuePosition")
        if existingBodyPosition then
            existingBodyPosition.Position = savedPosition
        else
            local newBodyPosition = Instance.new("BodyPosition")
            newBodyPosition.Name = "ExpertSelfRescuePosition"
            newBodyPosition.P = 100000
            newBodyPosition.D = 1000
            newBodyPosition.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            newBodyPosition.Position = savedPosition
            newBodyPosition.Parent = currentRootPart
        end
    end)
    
    if isMinimized then statusLabel.Text = "ğŸ”’ å·²å›ºå®šä½ç½®" end
    return true
end

local function stopSelfRescue()
    if not isSelfRescueActive then return end
    isSelfRescueActive = false
    if selfRescueConnection then
        selfRescueConnection:Disconnect()
        selfRescueConnection = nil
    end
    
    local character = player.Character
    if character then
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            local bodyPosition = humanoidRootPart:FindFirstChild("ExpertSelfRescuePosition")
            if bodyPosition then bodyPosition:Destroy() end
        end
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 16
            humanoid.JumpPower = 50
        end
    end
    
    selfRescueButton.Text = "è‡ªæ•‘\nå›ºå®šä½ç½® [OFF]"
    selfRescueButton.BackgroundColor3 = Color3.fromRGB(180, 60, 180)
    if isMinimized then statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€" end
    savedPosition = nil
    savedCFrame = nil
end

-- é€šç”¨ä¼ é€å‡½æ•°
local function performTeleport(location, button, locationName)
    if isSelfRescueActive then stopSelfRescue() end
    
    local character = player.Character
    if not character then return false end

    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return false end

    local teleportPos = Vector3.new(location.X, location.Y, location.Z)
    humanoidRootPart.CFrame = CFrame.new(teleportPos)

    if not isMinimized and button then
        local originalText = button.Text
        button.Text = "âœ… å·²ä¼ é€"
        task.wait(3)
        button.Text = originalText
    end

    if isMinimized then
        statusLabel.Text = "âœ… å·²ä¼ é€" .. locationName
        task.wait(3)
        statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
    end

    return true
end

-- æ‰§è¡Œç­‰å€™å…ä¼ é€
local function performBackroomTeleport()
    return performTeleport(backroomLocation, backroomTeleportButton, "ç­‰å€™å…")
end

-- æ‰§è¡Œå‰§é™¢ç«è½¦ä¼ é€
local function performTheaterTrainTeleport()
    return performTeleport(theaterTrainLocation, theaterTrainButton, "å‰§é™¢ç«è½¦")
end

-- æ‰§è¡Œå·¥å‚ç«è½¦ä¼ é€
local function performFactoryTrainTeleport()
    return performTeleport(factoryTrainLocation, factoryTrainButton, "å·¥å‚ç«è½¦")
end

-- æ‰§è¡Œä¸‹æ°´é“ä¼ é€
local function performSewerTeleport()
    return performTeleport(sewerLocation, sewerTeleportButton, "ä¸‹æ°´é“")
end

-- ä»™äººæ¨¡å¼åŠŸèƒ½
local function startNinjaMode()
    if isNinjaModeActive then return end
    
    local character = player.Character
    if not character then return false end

    local humanoid = character:FindFirstChild("Humanoid")
    if not humanoid then return false end

    originalWalkSpeed = humanoid.WalkSpeed
    originalJumpPower = humanoid.JumpPower
    isNinjaModeActive = true
    infiniteJumpEnabled = true
    ninjaModeButton.Text = "ä»™äººæ¨¡å¼\n[ON]"
    ninjaModeButton.BackgroundColor3 = Color3.fromRGB(220, 140, 0)
    
    humanoid.WalkSpeed = originalWalkSpeed * ninjaModeMultiplier
    humanoid.JumpPower = originalJumpPower * 3

    ninjaModeConnection = UserInputService.JumpRequest:Connect(function()
        if infiniteJumpEnabled and character and character:FindFirstChild("Humanoid") then
            character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end)
    
    if isMinimized then statusLabel.Text = "âš¡ ä»™äººæ¨¡å¼" end
    return true
end

local function stopNinjaMode()
    if not isNinjaModeActive then return end
    isNinjaModeActive = false
    infiniteJumpEnabled = false
    
    if ninjaModeConnection then
        ninjaModeConnection:Disconnect()
        ninjaModeConnection = nil
    end
    
    local character = player.Character
    if character then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = originalWalkSpeed
            humanoid.JumpPower = originalJumpPower
        end
    end
    
    ninjaModeButton.Text = "ä»™äººæ¨¡å¼\n[OFF]"
    ninjaModeButton.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
    if isMinimized then statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€" end
end

-- æŒ‰é’®ç‚¹å‡»äº‹ä»¶
backroomTeleportButton.MouseButton1Click:Connect(performBackroomTeleport)
theaterTrainButton.MouseButton1Click:Connect(performTheaterTrainTeleport)
factoryTrainButton.MouseButton1Click:Connect(performFactoryTrainTeleport)
sewerTeleportButton.MouseButton1Click:Connect(performSewerTeleport)
selfRescueButton.MouseButton1Click:Connect(function()
    if isSelfRescueActive then stopSelfRescue() else startSelfRescue() end
end)
ninjaModeButton.MouseButton1Click:Connect(function()
    if isNinjaModeActive then stopNinjaMode() else startNinjaMode() end
end)

-- ç¼©æ”¾åŠŸèƒ½
zoomBtn.MouseButton1Click:Connect(function()
    isZoomed = not isZoomed
    if isZoomed then
        local currentPos = mainFrame.Position
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = zoomedSize, Position = currentPos
        })
        tween:Play()
        zoomBtn.Text = "âºï¸"
        zoomBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
        if not isMinimized then
            backroomTeleportButton.TextSize = 15
            theaterTrainButton.TextSize = 15
            factoryTrainButton.TextSize = 15
            sewerTeleportButton.TextSize = 15
            selfRescueButton.TextSize = 15
            ninjaModeButton.TextSize = 15
            title.TextSize = 15
        end
    else
        local currentPos = mainFrame.Position
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = originalSize, Position = currentPos
        })
        tween:Play()
        zoomBtn.Text = "â¬…ï¸"
        zoomBtn.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
        if not isMinimized then
            backroomTeleportButton.TextSize = 14
            theaterTrainButton.TextSize = 14
            factoryTrainButton.TextSize = 14
            sewerTeleportButton.TextSize = 14
            selfRescueButton.TextSize = 14
            ninjaModeButton.TextSize = 14
            title.TextSize = 14
        end
    end
end)

-- ç¼©å°åŠŸèƒ½
minimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        local currentPos = mainFrame.Position
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = minimizedSize, Position = currentPos
        })
        tween:Play()
        tween.Completed:Wait()
        backroomTeleportButton.Visible = false
        theaterTrainButton.Visible = false
        factoryTrainButton.Visible = false
        sewerTeleportButton.Visible = false
        selfRescueButton.Visible = false
        ninjaModeButton.Visible = false
        statusLabel.Visible = true
        minimizeBtn.Text = "+"
        title.Text = "ğŸ¯"
        if isSelfRescueActive then
            statusLabel.Text = "ğŸ”’ å›ºå®šä½ç½®"
        elseif isNinjaModeActive then
            statusLabel.Text = "âš¡ ä»™äººæ¨¡å¼"
        else
            statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
        end
    else
        backroomTeleportButton.Visible = true
        theaterTrainButton.Visible = true
        factoryTrainButton.Visible = true
        sewerTeleportButton.Visible = true
        selfRescueButton.Visible = true
        ninjaModeButton.Visible = true
        statusLabel.Visible = false
        minimizeBtn.Text = "_"
        title.Text = "Expert"
        local currentPos = mainFrame.Position
        local targetSize = isZoomed and zoomedSize or originalSize
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
            Size = targetSize, Position = currentPos
        })
        tween:Play()
    end
end)

-- å…³é—­åŠŸèƒ½
closeBtn.MouseButton1Click:Connect(function()
    if isSelfRescueActive then stopSelfRescue() end
    if isNinjaModeActive then stopNinjaMode() end
    local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
        BackgroundTransparency = 0.8,
        Position = mainFrame.Position + UDim2.new(0, 0, 0, -20)
    })
    tween:Play()
    tween.Completed:Wait()
    screenGui:Destroy()
    isRunning = false
end)

-- å¿«æ·é”®
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.B then performBackroomTeleport()
    elseif input.KeyCode == Enum.KeyCode.T then performTheaterTrainTeleport()
    elseif input.KeyCode == Enum.KeyCode.F then performFactoryTrainTeleport()
    elseif input.KeyCode == Enum.KeyCode.S then performSewerTeleport()
    elseif input.KeyCode == Enum.KeyCode.R then
        if isSelfRescueActive then stopSelfRescue() else startSelfRescue() end
    elseif input.KeyCode == Enum.KeyCode.N then
        if isNinjaModeActive then stopNinjaMode() else startNinjaMode() end
    elseif input.KeyCode == Enum.KeyCode.M then
        isMinimized = not isMinimized
        if isMinimized then
            local currentPos = mainFrame.Position
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = minimizedSize, Position = currentPos
            })
            tween:Play()
            tween.Completed:Wait()
            backroomTeleportButton.Visible = false
            theaterTrainButton.Visible = false
            factoryTrainButton.Visible = false
            sewerTeleportButton.Visible = false
            selfRescueButton.Visible = false
            ninjaModeButton.Visible = false
            statusLabel.Visible = true
            minimizeBtn.Text = "+"
            title.Text = "ğŸ¯"
            if isSelfRescueActive then
                statusLabel.Text = "ğŸ”’ å›ºå®šä½ç½®"
            elseif isNinjaModeActive then
                statusLabel.Text = "âš¡ ä»™äººæ¨¡å¼"
            else
                statusLabel.Text = "Expert\nç‚¹å‡»å±•å¼€"
            end
        else
            backroomTeleportButton.Visible = true
            theaterTrainButton.Visible = true
            factoryTrainButton.Visible = true
            sewerTeleportButton.Visible = true
            selfRescueButton.Visible = true
            ninjaModeButton.Visible = true
            statusLabel.Visible = false
            minimizeBtn.Text = "_"
            title.Text = "Expert"
            local currentPos = mainFrame.Position
            local targetSize = isZoomed and zoomedSize or originalSize
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = targetSize, Position = currentPos
            })
            tween:Play()
        end
    elseif input.KeyCode == Enum.KeyCode.Z then
        isZoomed = not isZoomed
        if isZoomed then
            local currentPos = mainFrame.Position
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = zoomedSize, Position = currentPos
            })
            tween:Play()
            zoomBtn.Text = "â–¶ï¸"
            zoomBtn.BackgroundColor3 = Color3.fromRGB(80, 140, 220)
            if not isMinimized then
                backroomTeleportButton.TextSize = 15
                theaterTrainButton.TextSize = 15
                factoryTrainButton.TextSize = 15
                sewerTeleportButton.TextSize = 15
                selfRescueButton.TextSize = 15
                ninjaModeButton.TextSize = 15
                title.TextSize = 15
            end
        else
            local currentPos = mainFrame.Position
            local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3), {
                Size = originalSize, Position = currentPos
            })
            tween:Play()
            zoomBtn.Text = "â¸ï¸"
            zoomBtn.BackgroundColor3 = Color3.fromRGB(60, 100, 180)
            if not isMinimized then
                backroomTeleportButton.TextSize = 14
                theaterTrainButton.TextSize = 14
                factoryTrainButton.TextSize = 14
                sewerTeleportButton.TextSize = 14
                selfRescueButton.TextSize = 14
                ninjaModeButton.TextSize = 14
                title.TextSize = 14
            end
        end
    end
end)

-- è§’è‰²é‡ç”Ÿå¤„ç†
player.CharacterAdded:Connect(function(character)
    if isSelfRescueActive then stopSelfRescue() end
    if isNinjaModeActive then
        task.wait(0.5)
        if isNinjaModeActive then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = originalWalkSpeed * ninjaModeMultiplier
                humanoid.JumpPower = originalJumpPower * 3
                if ninjaModeConnection then ninjaModeConnection:Disconnect() end
                ninjaModeConnection = UserInputService.JumpRequest:Connect(function()
                    if infiniteJumpEnabled and character and character:FindFirstChild("Humanoid") then
                        character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                end)
            end
        end
    end
end)

-- åˆå§‹æ·¡å…¥åŠ¨ç”»
local originalPosition = UDim2.new(0.02, 0, 0.3, 0)
mainFrame.BackgroundTransparency = 1
mainFrame.Position = originalPosition + UDim2.new(0, 0, 0, -30)
task.wait(0.1)
local fadeInTween = TweenService:Create(mainFrame, TweenInfo.new(0.5), {
    BackgroundTransparency = 0.2, Position = originalPosition
})
fadeInTween:Play()

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Expert",
    Text = "è„šæœ¬å·²åŠ è½½ - B/T/F/S/R/N/M/Zé”®",
    Icon = "rbxassetid://14550088217",
    Duration = 5,
    Position = UDim2.new(0, 20, 1, -50)
})